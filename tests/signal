#! /bin/sh
# Test signal handling for the gzip

pid=''
fail=0
filename="signal-segv"

. "${srcdir=.}/init.sh"; path_prepend_ ..

head -c 2000000 </dev/urandom >${filename}

set -x
for sig in \
    INT \
    HUP \
    PIPE \
    TERM \
    XCPU \
    XFSZ
do
  cp ${filename} "${filename}-${sig}" || fail=1
  ${gzip} "${filename}-${sig}" &
  pid=$!
  test -n ${pid} || fail=1
  kill -${sig} ${pid} || fail=1
  test -f "${filename}-${sig}" || fail=1
  test -f "${filename}-${sig}.gz" && fail=1
  diff ${filename} "${filename}-${sig}" || fail=1
  rm -f "${filename}-${sig}"
done

rm -f ${filename}

Exit ${fail}
