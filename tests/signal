#! /bin/sh
# Test signal handling for the gzip

. "${srcdir=.}/init.sh"; path_prepend_ ..

gzip="gzip"
pid=''
fail=0
filename="signal-segv"

head -c 20M </dev/urandom >${filename}

cp ${filename} "${filename}1" || fail=1

for sig in 1 2 13 15 24 25
do
  cp ${filename} "${filename}1" || fail=1
  ${gzip} "${filename}1" &
  pid=$!
  test -n ${pid} || fail=1
  kill -${sig} ${pid} || fail=1
  pgrep -c ${pid} && fail=1
  test -f "${filename}1" || fail=1
  test -f "${filename}1.gz" && fail=1
  compare ${filename} "${filename}1" || fail=1
done

Exit ${fail}
